import{S as $,i as ee,s as ae,k as c,r as F,a as O,l as m,m as h,u as R,h as r,c as S,p as i,q as Q,b as I,D as n,K as W,E as A,L as X,n as Z,M as re,J as te}from"../chunks/index.0e58c74b.js";import{g as se}from"../chunks/navigation.2cfe3a99.js";import{p as oe}from"../chunks/stores.2f18ef1e.js";import{s as T}from"../chunks/supabaseClient.e8e52d2c.js";function le(p){let _,v,y,d,o,l,w,D,f,L,t,u,a,N,E,P,g,U,B,k,b,V,q,M;return{c(){_=c("h1"),v=F("Change your email and / or password"),y=O(),d=c("form"),o=c("div"),l=c("label"),w=F("New email"),D=O(),f=c("input"),L=O(),t=c("div"),u=c("input"),N=O(),E=c("form"),P=c("div"),g=c("button"),U=F("Reset password"),B=O(),k=c("div"),b=c("a"),V=F("Back to edit my account"),this.h()},l(e){_=m(e,"H1",{});var s=h(_);v=R(s,"Change your email and / or password"),s.forEach(r),y=S(e),d=m(e,"FORM",{class:!0});var x=h(d);o=m(x,"DIV",{class:!0});var C=h(o);l=m(C,"LABEL",{for:!0});var H=h(l);w=R(H,"New email"),H.forEach(r),D=S(C),f=m(C,"INPUT",{class:!0,type:!0,placeholder:!0}),L=S(C),t=m(C,"DIV",{});var J=h(t);u=m(J,"INPUT",{type:!0,class:!0}),J.forEach(r),C.forEach(r),x.forEach(r),N=S(e),E=m(e,"FORM",{class:!0});var K=h(E);P=m(K,"DIV",{class:!0});var Y=h(P);g=m(Y,"BUTTON",{class:!0});var j=h(g);U=R(j,"Reset password"),j.forEach(r),Y.forEach(r),K.forEach(r),B=S(e),k=m(e,"DIV",{class:!0});var z=h(k);b=m(z,"A",{href:!0,style:!0});var G=h(b);V=R(G,"Back to edit my account"),G.forEach(r),z.forEach(r),this.h()},h(){i(l,"for","new_email"),i(f,"class","inputField"),i(f,"type","new_email"),i(f,"placeholder",p[0]),i(u,"type","submit"),i(u,"class","button block primary"),u.value=a=p[1]?"Loading":"Save",u.disabled=p[1],i(o,"class","col-6 form-widget"),i(d,"class","row flex-center flex"),i(g,"class","button block primary"),i(P,"class","col-6 form-widget"),i(E,"class","row flex-center flex"),i(b,"href","/protected_routes/account/update"),Q(b,"margin-top","5px"),Q(b,"margin-bottom","15px"),i(k,"class","footer flex-center")},m(e,s){I(e,_,s),n(_,v),I(e,y,s),I(e,d,s),n(d,o),n(o,l),n(l,w),n(o,D),n(o,f),W(f,p[0]),n(o,L),n(o,t),n(t,u),I(e,N,s),I(e,E,s),n(E,P),n(P,g),n(g,U),I(e,B,s),I(e,k,s),n(k,b),n(b,V),q||(M=[A(f,"input",p[4]),A(d,"submit",X(p[2])),A(g,"click",X(p[3]))],q=!0)},p(e,[s]){s&1&&i(f,"placeholder",e[0]),s&1&&W(f,e[0]),s&2&&a!==(a=e[1]?"Loading":"Save")&&(u.value=a),s&2&&(u.disabled=e[1])},i:Z,o:Z,d(e){e&&r(_),e&&r(y),e&&r(d),e&&r(N),e&&r(E),e&&r(B),e&&r(k),q=!1,re(M)}}}function ie(p,_,v){let y;te(p,oe,t=>v(5,y=t));let d=y.data.session.user,o=d.email,l,w=!1;async function D(){try{if(v(1,w=!0),!l)throw new Error("Please enter a new email");const{data:t,error:u}=await T.auth.updateUser({email:l});try{const{data:a,error:N}=await T.from("users").update({email:l||o}).eq("id",d.id)}catch(a){a instanceof Error&&alert(a.message)}v(1,w=!1),alert("Your email has been updated! Check your email for the confirmation link.");try{const{error:a}=await T.auth.signOut();if(a)throw a}catch(a){a instanceof Error&&alert(a.message)}se("/signIn",{invalidateAll:!0})}catch(t){t instanceof Error&&alert(t.message)}finally{v(1,w=!1)}}async function f(){try{const{data:t,error:u}=await T.auth.resetPasswordForEmail(o||"",{redirectTo:"/"});if(u)throw u;alert("Check your email for the password reset link!");try{const{error:a}=await T.auth.signOut();if(a)throw a}catch(a){a instanceof Error&&alert(a.message)}}catch(t){t instanceof Error&&alert(t.message)}}function L(){l=this.value,v(0,l)}return[l,w,D,f,L]}class me extends ${constructor(_){super(),ee(this,_,ie,le,ae,{})}}export{me as default};
