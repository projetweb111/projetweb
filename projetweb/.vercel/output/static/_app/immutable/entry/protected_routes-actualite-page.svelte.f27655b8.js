import{S as fe,i as _e,s as ce,k as v,r as m,a as P,e as j,l as b,m as E,u as h,h as f,c as T,b as y,D as n,n as te,J as ue,o as de,L as pe,p as ee,E as me,v as B}from"../chunks/index.ce7212fb.js";import{s as V}from"../chunks/supabaseClient.e8e52d2c.js";import{p as he}from"../chunks/stores.37c6b56c.js";function oe(o,s,r){const l=o.slice();return l[7]=s[r],l}function ke(o){let s,r;return{c(){s=v("p"),r=m("loading...")},l(l){s=b(l,"P",{});var t=E(s);r=h(t,"loading..."),t.forEach(f)},m(l,t){y(l,s,t),n(s,r)},p:te,d(l){l&&f(s)}}}function ve(o){let s,r=o[0],l=[];for(let t=0;t<r.length;t+=1)l[t]=re(oe(o,r,t));return{c(){for(let t=0;t<l.length;t+=1)l[t].c();s=j()},l(t){for(let c=0;c<l.length;c+=1)l[c].l(t);s=j()},m(t,c){for(let a=0;a<l.length;a+=1)l[a].m(t,c);y(t,s,c)},p(t,c){if(c&3){r=t[0];let a;for(a=0;a<r.length;a+=1){const u=oe(t,r,a);l[a]?l[a].p(u,c):(l[a]=re(u),l[a].c(),l[a].m(s.parentNode,s))}for(;a<l.length;a+=1)l[a].d(1);l.length=r.length}},d(t){pe(l,t),t&&f(s)}}}function re(o){let s,r,l,t=o[7].title+"",c,a,u,D,w=o[7].association+"",i,e,_,k,L=o[7].users.first_name+"",M,H,q,I,z,F,N,R=o[7].content+"",C,J,A,S,G,O,K,g=o[7].count_likes+"",Y,Q,W,le;function ne(){return o[2](o[7])}return{c(){s=v("div"),r=v("h3"),l=m("Title: "),c=m(t),a=P(),u=v("p"),D=m("Association: "),i=m(w),e=P(),_=v("p"),k=m("Author:"),M=m(L),H=P(),q=v("details"),I=v("summary"),z=m("Read more"),F=P(),N=v("p"),C=m(R),J=P(),A=v("div"),S=v("button"),G=m("♡"),K=P(),Y=m(g),Q=P(),this.h()},l(d){s=b(d,"DIV",{class:!0});var p=E(s);r=b(p,"H3",{});var X=E(r);l=h(X,"Title: "),c=h(X,t),X.forEach(f),a=T(p),u=b(p,"P",{});var Z=E(u);D=h(Z,"Association: "),i=h(Z,w),Z.forEach(f),e=T(p),_=b(p,"P",{});var x=E(_);k=h(x,"Author:"),M=h(x,L),x.forEach(f),p.forEach(f),H=T(d),q=b(d,"DETAILS",{});var $=E(q);I=b($,"SUMMARY",{});var se=E(I);z=h(se,"Read more"),se.forEach(f),F=T($),N=b($,"P",{});var ie=E(N);C=h(ie,R),ie.forEach(f),$.forEach(f),J=T(d),A=b(d,"DIV",{});var U=E(A);S=b(U,"BUTTON",{id:!0});var ae=E(S);G=h(ae,"♡"),ae.forEach(f),K=T(U),Y=h(U,g),Q=T(U),U.forEach(f),this.h()},h(){ee(s,"class","post"),ee(S,"id",O=o[7].title)},m(d,p){y(d,s,p),n(s,r),n(r,l),n(r,c),n(s,a),n(s,u),n(u,D),n(u,i),n(s,e),n(s,_),n(_,k),n(_,M),y(d,H,p),y(d,q,p),n(q,I),n(I,z),n(q,F),n(q,N),n(N,C),y(d,J,p),y(d,A,p),n(A,S),n(S,G),n(A,K),n(A,Y),n(A,Q),W||(le=me(S,"click",ne),W=!0)},p(d,p){o=d,p&1&&t!==(t=o[7].title+"")&&B(c,t),p&1&&w!==(w=o[7].association+"")&&B(i,w),p&1&&L!==(L=o[7].users.first_name+"")&&B(M,L),p&1&&R!==(R=o[7].content+"")&&B(C,R),p&1&&O!==(O=o[7].title)&&ee(S,"id",O),p&1&&g!==(g=o[7].count_likes+"")&&B(Y,g)},d(d){d&&f(s),d&&f(H),d&&f(q),d&&f(J),d&&f(A),W=!1,le()}}}function be(o){let s,r,l,t,c,a,u;function D(e,_){return e[0]?ve:ke}let w=D(o),i=w(o);return{c(){s=v("h1"),r=m("Actualités"),l=P(),t=v("h2"),c=m("Voici les dernières actualités :"),a=P(),i.c(),u=j()},l(e){s=b(e,"H1",{});var _=E(s);r=h(_,"Actualités"),_.forEach(f),l=T(e),t=b(e,"H2",{});var k=E(t);c=h(k,"Voici les dernières actualités :"),k.forEach(f),a=T(e),i.l(e),u=j()},m(e,_){y(e,s,_),n(s,r),y(e,l,_),y(e,t,_),n(t,c),y(e,a,_),i.m(e,_),y(e,u,_)},p(e,[_]){w===(w=D(e))&&i?i.p(e,_):(i.d(1),i=w(e),i&&(i.c(),i.m(u.parentNode,u)))},i:te,o:te,d(e){e&&f(s),e&&f(l),e&&f(t),e&&f(a),i.d(e),e&&f(u)}}}function Ee(o,s,r){let l;ue(o,he,i=>r(4,l=i));let t=!1,c=null;de(()=>{a()});const a=async()=>{try{t=!0;let{data:i,error:e}=await V.from("post").select("*,users(first_name)").order("date_publish",{ascending:!0});if(i&&r(0,c=i),e)throw e}catch(i){i instanceof Error&&alert(i.message)}finally{t=!1}},u=async i=>{try{t=!0;let{data:e,error:_}=await V.from("post").select("count_likes,id").eq("title",i).single(),k=e==null?void 0:e.id,L=e==null?void 0:e.count_likes;if(e)if(await D(k)){let{data:H}=await V.from("post").update({count_likes:L-1}).eq("id",k),{data:q}=await V.from("like_post").delete().eq("id_post",k).eq("id_user",l.data.session.user.id)}else{let{data:H,error:q}=await V.from("post").update({count_likes:L+1}).eq("id",k),{data:I}=await V.from("like_post").upsert([{id_post:k,id_user:l.data.session.user.id}])}if(_)throw _}catch(e){e instanceof Error&&alert(e.message)}finally{t=!1,a()}},D=async i=>{let{data:e}=await V.from("like_post").select("*").eq("id_post",i).eq("id_user",l.data.session.user.id);return!!(e&&e.length>0)};return[c,u,i=>u(i.title)]}class Ae extends fe{constructor(s){super(),_e(this,s,Ee,be,ce,{})}}export{Ae as default};
