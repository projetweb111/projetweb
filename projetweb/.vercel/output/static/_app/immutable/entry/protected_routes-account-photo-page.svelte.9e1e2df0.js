import{S as Q,i as W,s as X,a as N,k as w,r as M,c as V,l as E,m as U,u as O,h as f,p as o,q as S,b as q,D as b,E as T,v as J,n as z,M as Y,J as Z,o as x,O as H}from"../chunks/index.0e58c74b.js";import{p as $}from"../chunks/stores.2f18ef1e.js";import{s as B}from"../chunks/supabaseClient.e8e52d2c.js";function K(c){let l,t,i,r;return{c(){l=w("div"),t=w("img"),this.h()},l(n){l=E(n,"DIV",{class:!0});var p=U(l);t=E(p,"IMG",{src:!0,alt:!0,class:!0}),p.forEach(f),this.h()},h(){H(t.src,i=c[1])||o(t,"src",i),o(t,"alt",r=c[3]?"Downloading ...":""),o(t,"class","avatar image"),o(l,"class","avatar image fmex-center")},m(n,p){q(n,l,p),b(l,t)},p(n,p){p&2&&!H(t.src,i=n[1])&&o(t,"src",i),p&8&&r!==(r=n[3]?"Downloading ...":"")&&o(t,"alt",r)},d(n){n&&f(l)}}}function ee(c){let l,t,i,r=c[2]?"Uploading ...":"Upload a new photo",n,p,m,u,g,d,y,h=c[4]?"Deleting ...":"Delete the photo",D,k,_,v,I,P,L,s=c[1]&&K(c);return{c(){s&&s.c(),l=N(),t=w("div"),i=w("label"),n=M(r),p=N(),m=w("span"),u=w("input"),g=N(),d=w("div"),y=w("button"),D=M(h),k=N(),_=w("div"),v=w("a"),I=M("Back to edit my account"),this.h()},l(e){s&&s.l(e),l=V(e),t=E(e,"DIV",{class:!0});var a=U(t);i=E(a,"LABEL",{class:!0,for:!0});var A=U(i);n=O(A,r),A.forEach(f),p=V(a),m=E(a,"SPAN",{style:!0});var C=U(m);u=E(C,"INPUT",{type:!0,id:!0,accept:!0}),C.forEach(f),a.forEach(f),g=V(e),d=E(e,"DIV",{class:!0});var R=U(d);y=E(R,"BUTTON",{class:!0});var j=U(y);D=O(j,h),j.forEach(f),R.forEach(f),k=V(e),_=E(e,"DIV",{class:!0});var F=U(_);v=E(F,"A",{href:!0,style:!0});var G=U(v);I=O(G,"Back to edit my account"),G.forEach(f),F.forEach(f),this.h()},h(){o(i,"class","button primary block"),o(i,"for","single"),o(u,"type","file"),o(u,"id","single"),o(u,"accept","image/*"),u.disabled=c[2],S(m,"display","none"),o(t,"class","body"),o(y,"class","button primary block"),o(d,"class","body"),o(v,"href","/protected_routes/account/update"),S(v,"margin-top","5px"),S(v,"margin-bottom","15px"),o(_,"class","footer flex-center")},m(e,a){s&&s.m(e,a),q(e,l,a),q(e,t,a),b(t,i),b(i,n),b(t,p),b(t,m),b(m,u),q(e,g,a),q(e,d,a),b(d,y),b(y,D),q(e,k,a),q(e,_,a),b(_,v),b(v,I),P||(L=[T(u,"change",c[7]),T(u,"change",c[5]),T(y,"click",c[6])],P=!0)},p(e,[a]){e[1]?s?s.p(e,a):(s=K(e),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null),a&4&&r!==(r=e[2]?"Uploading ...":"Upload a new photo")&&J(n,r),a&4&&(u.disabled=e[2]),a&16&&h!==(h=e[4]?"Deleting ...":"Delete the photo")&&J(D,h)},i:z,o:z,d(e){s&&s.d(e),e&&f(l),e&&f(t),e&&f(g),e&&f(d),e&&f(k),e&&f(_),P=!1,Y(L)}}}function te(c,l,t){let i;Z(c,$,e=>t(13,i=e));let r=i.data.session.user,n=null,p=null,m,u=null,g=null,d=null,y=!1,h=!1,D=!1,k=!1;x(()=>{_()});const _=async()=>{try{y=!0;let{data:e,error:a}=await B.from("users").select("first_name, last_name, photo").eq("id",r.id).single();if(e&&(n=e.first_name,p=e.last_name,g=e.photo),a)throw a}catch(e){e instanceof Error&&alert(e.message)}finally{y=!1,P()}},v=async()=>{try{t(2,h=!0);const e=m[0],{data:a,error:A}=await B.storage.from("avatars").upload(`${r.id}/avatar_${e.name}`,e,{cacheControl:"3600",upsert:!0});if(a&&(d=`avatar_${e.name}`),I(),A)throw A}catch(e){e instanceof Error&&alert(e.message)}finally{t(2,h=!1)}},I=async()=>{try{t(2,h=!0);let{error:e}=await B.from("users").update({photo:d||g}).eq("id",r.id);if(e)throw e}catch(e){e instanceof Error&&alert(e.message)}finally{t(2,h=!1),_()}},P=async()=>{if(g)try{t(3,D=!0);const{data:e,error:a}=await B.storage.from("avatars").download(`${r.id}/${g}`);if(e&&t(1,u=URL.createObjectURL(e)),a)throw a}catch(e){e instanceof Error&&alert(e.message)}finally{t(3,D=!1)}},L=async()=>{try{t(4,k=!0);let{error:e}=await B.from("users").update({photo:null}).eq("id",r.id);if(g=null,d=null,t(1,u=null),e)throw e}catch(e){e instanceof Error&&alert(e.message)}finally{t(4,k=!1),_()}};function s(){m=this.files,t(0,m)}return[m,u,h,D,k,v,L,s]}class re extends Q{constructor(l){super(),W(this,l,te,ee,X,{})}}export{re as default};
